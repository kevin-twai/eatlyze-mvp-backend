*** Begin Patch
*** Update File: backend/app/services/openai_client.py
@@
-    completion = await client.chat.completions.create(
-    model="gpt-4o-mini",
-    messages=[
-        {"role": "system", "content": "You are a nutrition analysis assistant."},
-        {
-            "role": "user",
-            "content": [
-                {"type": "text", "text": "Analyze this meal photo"},
-                {"type": "image_url", "image_url": {"url": image_b64}},  # ✅ 正確格式
-            ],
-        },
-    ],
-)
-    return completion.choices[0].message.content
+    from openai import OpenAIError
+    import httpx
+    try:
+        completion = await client.chat.completions.create(
+            model="gpt-4o-mini",
+            messages=[
+                {"role": "system", "content": "You are a nutrition analysis assistant."},
+                {
+                    "role": "user",
+                    "content": [
+                        {"type": "text", "text": "Analyze this meal photo"},
+                        {
+                            "type": "image_url",
+                            "image_url": {
+                                "url": "data:image/jpeg;base64," + base64_str,
+                                "detail": "high"
+                            }
+                        },
+                    ],
+                },
+            ],
+            max_tokens=800,
+            temperature=0.2,
+        )
+        return completion.choices[0].message.content or ""
+    except (OpenAIError, httpx.HTTPError) as e:
+        raise RuntimeError(f"openai_call_failed: {type(e).__name__}: {e}") from e
*** End Patch